{"data":{"site":{"siteMetadata":{"author":{"name":"kim beom gyu","contacts":{"twitter":"#"}},"disqusShortname":"","subtitle":"Pellentesque odio nisi, euismod in, pharetra a, ultricies in, diam. Sed arcu.","title":"Blog by kimbeomgyu","url":"https://lumen.netlify.com"}},"markdownRemark":{"id":"f04fe47a-5ed0-54b1-94e2-5c1b1f6d9510","html":"<h2 id=\"한-일\"><a href=\"#%ED%95%9C-%EC%9D%BC\" aria-label=\"한 일 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>한 일</h2>\n<h4 id=\"mongodb-권한-설정\"><a href=\"#mongodb-%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95\" aria-label=\"mongodb 권한 설정 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mongodb 권한 설정</h4>\n<hr>\n<h6 id=\"mongodb-권한-설정-1\"><a href=\"#mongodb-%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95-1\" aria-label=\"mongodb 권한 설정 1 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mongodb 권한 설정</h6>\n<p>며칠전 코드리뷰를 통해 매우매우 중요한 파일을 github에 올려버렸다는걸 알게 되었다. config 파일이였는데 토큰의 암호와 DB의 접속하는 url을 적어두었는데 커밋이 되어버려서 우선 config파일을 숨기고, 급하게 암호를 바꾸고 DB의 접근을 막기 위해 권한설정에 대해 다시 공부했다. 처음에 시도할때는 잘 되지 않아서 그냥 풀어뒀는데 해결했다.</p>\n<p>다시는 config파일을 깃에 올리지 말자….</p>\n<h6 id=\"사용자-목록-확인\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%AA%A9%EB%A1%9D-%ED%99%95%EC%9D%B8\" aria-label=\"사용자 목록 확인 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자 목록 확인</h6>\n<p><code class=\"language-text\">use admin</code></p>\n<p><code class=\"language-text\">show users</code></p>\n<h6 id=\"모든-데이터베이스내의-사용자\"><a href=\"#%EB%AA%A8%EB%93%A0-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EB%82%B4%EC%9D%98-%EC%82%AC%EC%9A%A9%EC%9E%90\" aria-label=\"모든 데이터베이스내의 사용자 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모든 데이터베이스내의 사용자</h6>\n<p><code class=\"language-text\">use admin</code></p>\n<p><code class=\"language-text\">cur = db.system.users.find()</code></p>\n<p><code class=\"language-text\">cur.count()</code></p>\n<h6 id=\"계정생성\"><a href=\"#%EA%B3%84%EC%A0%95%EC%83%9D%EC%84%B1\" aria-label=\"계정생성 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>계정생성</h6>\n<p><code class=\"language-text\">db.createUser</code> 해당 데이터베이스의 유저객체를 생성한다.</p>\n<ul>\n<li>관리자 계정 생성 예시</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">use test\ndb<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">:</span> <span class=\"token string\">\"testUser\"</span><span class=\"token punctuation\">,</span>\n    pwd<span class=\"token punctuation\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span>\n    roles<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"readWrite\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dbAdmin\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>읽기권한, 특정 데이터베이스 읽고쓰기 권한 계정 생성 예시</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">use admin\ndb<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">:</span> <span class=\"token string\">\"testUser\"</span><span class=\"token punctuation\">,</span>\n    userSource<span class=\"token punctuation\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span>\n    roles<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"read\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    otherDBRoles<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span> testDB2<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"readWrite\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span></code></pre></div>\n<h6 id=\"사용자-삭제\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%82%AD%EC%A0%9C\" aria-label=\"사용자 삭제 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자 삭제</h6>\n<p><code class=\"language-text\">db.dropUser</code> 해당 데이터베이스의 유저객체를 삭제한다.</p>\n<ul>\n<li>삭제 예시</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  use testDB\n  db<span class=\"token punctuation\">.</span><span class=\"token function\">dropUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testUser\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h6 id=\"사용자-관리자-계정-생성\"><a href=\"#%EC%82%AC%EC%9A%A9%EC%9E%90-%EA%B4%80%EB%A6%AC%EC%9E%90-%EA%B3%84%EC%A0%95-%EC%83%9D%EC%84%B1\" aria-label=\"사용자 관리자 계정 생성 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용자 관리자 계정 생성</h6>\n<p>사용자 관리자는 데이터베이스나 다른 관리 기능을 운영하는 권한 말고 사용자를 생성할 수 있는 권한만 갖고 있어야 한다.</p>\n<ul>\n<li>\n<p>사용자를 생성하는 권한을 가진 계정 예시</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">use admin\ndb<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">:</span> <span class=\"token string\">\"useradmin\"</span><span class=\"token punctuation\">,</span>\npwd<span class=\"token punctuation\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span>\nroles<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"userAdminAnyDatabase\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ul>\n<h6 id=\"인증\"><a href=\"#%EC%9D%B8%EC%A6%9D\" aria-label=\"인증 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증</h6>\n<p>—auth 파라미터를 사용해서 재시작해야한다.</p>\n<p><code class=\"language-text\">mongod -dbpath &lt;data/db&gt; —auth</code></p>\n<p>이후부터는 접근하기 위해 사용자와 패스워드를 이용해야 한다. 아니면 접속 후 명령어를 통해 로그인해야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">use admin\ndb<span class=\"token punctuation\">.</span><span class=\"token function\">auth</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"useradmin\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h6 id=\"권한-설정-후-접속방법\"><a href=\"#%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95-%ED%9B%84-%EC%A0%91%EC%86%8D%EB%B0%A9%EB%B2%95\" aria-label=\"권한 설정 후 접속방법 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>권한 설정 후 접속방법</h6>\n<p><code class=\"language-text\">mongo &lt; host : port &gt; -u &lt;user&gt; -p &lt;pwd&gt; --authenticationDatabase &lt;database&gt;</code></p>\n<h6 id=\"또다른-권한-방법\"><a href=\"#%EB%98%90%EB%8B%A4%EB%A5%B8-%EA%B6%8C%ED%95%9C-%EB%B0%A9%EB%B2%95\" aria-label=\"또다른 권한 방법 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>또다른 권한 방법</h6>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//루트계정생성</span>\n<span class=\"token operator\">></span> use admin\n<span class=\"token operator\">></span> db<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">:</span> <span class=\"token string\">\"ROOT_ID\"</span><span class=\"token punctuation\">,</span> pwd<span class=\"token punctuation\">:</span> <span class=\"token string\">\"ROOT_PASSWO\"</span><span class=\"token punctuation\">,</span> roles<span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"root\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//재시작</span>\n$ sudo service mongod restart\n$ mongo\n<span class=\"token operator\">></span> mongo <span class=\"token operator\">&lt;</span>host<span class=\"token punctuation\">:</span>port<span class=\"token operator\">></span> <span class=\"token operator\">-</span>u <span class=\"token string\">\"ROOT_ID\"</span> <span class=\"token operator\">-</span>p <span class=\"token string\">\"ROOT_PASSWO\"</span> <span class=\"token operator\">--</span>authenticationDatabase <span class=\"token string\">\"admin\"</span>\n\n<span class=\"token comment\">//데이터베이스계정생성</span>\n<span class=\"token operator\">></span> use <span class=\"token constant\">DATABASE</span>\n<span class=\"token operator\">></span> db<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>user<span class=\"token punctuation\">:</span> <span class=\"token string\">\"DB_USER_ID\"</span><span class=\"token punctuation\">,</span> pwd<span class=\"token punctuation\">:</span> <span class=\"token string\">\"DB_USER_PASSWORD\"</span><span class=\"token punctuation\">,</span> roles<span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"dbOwner\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//재접속</span>\n<span class=\"token operator\">></span> mongo <span class=\"token operator\">&lt;</span>host<span class=\"token punctuation\">:</span>port<span class=\"token operator\">/</span><span class=\"token constant\">DATABASE</span><span class=\"token operator\">></span> <span class=\"token operator\">-</span>u <span class=\"token string\">\"DB_USER_ID\"</span> <span class=\"token operator\">-</span>p <span class=\"token string\">\"DB_USER_PASSWORD\"</span></code></pre></div>","fields":{"slug":"/category/til/14/","tagSlugs":["/tag/til/","/tag/server/","/tag/mongodb/","/tag/auth/"]},"frontmatter":{"date":"2019-02-19T21:21:34.103Z","description":"mongodb 권한 설정!","tags":["TIL","server","mongodb","auth"],"title":"TIL-0219"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/category/til/14/"}}