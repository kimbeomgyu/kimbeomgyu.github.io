{"data":{"site":{"siteMetadata":{"author":{"name":"kim beom gyu","contacts":{"twitter":"#"}},"disqusShortname":"kimbeomgyu","subtitle":"반갑습니다. 신입 개발자 김범규입니다.","title":"Blog by kimbeomgyu","url":"https://kimbeomgyu.github.io"}},"markdownRemark":{"id":"4802657e-0296-5fc4-a622-1ad4b77204c8","html":"<h2>S3 버킷에 nodejs를 이용해 파일을 업로드 해서 저장하는 방법</h2>\n<h4>aws-sdk 모듈 설치</h4>\n<p><code class=\"language-text\">npm install aws-sdk —save</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">AWS</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aws-sdk'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">AWS</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">loadFromPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;&lt;config 파일위치>>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token constant\">AWS</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> region<span class=\"token punctuation\">:</span> <span class=\"token string\">'ap-northeast-2'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>aws-sdk : s3 접근에 필요한 모듈</li>\n<li>fs : 파일을 읽어오는 모듈</li>\n<li>config.loadFromPath: accessKeyId, secretAccessKey 를 config파일에 저장해둔다.</li>\n<li>서버에서 접근하려면 accessKeyId 와 secretAccessKey가 필요하고, 이 두개의 키는 AWS에서 S3에 접근 가능한 IAM User를 생성하면 발급!</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">config<span class=\"token punctuation\">.</span>json\n<span class=\"token punctuation\">{</span>\n  accessKeyId<span class=\"token punctuation\">:</span> <span class=\"token string\">\"비밀비밀\"</span><span class=\"token punctuation\">,</span>\n  secretAccessKey<span class=\"token punctuation\">:</span> <span class=\"token string\">\"더 비밀비밀\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>region을 적어준다. (서울은 “ap-northeast-2”)</p>\n<blockquote>\n<p>* IAM란 Identity and Access Management의 약자로, AWS 리소스에 대한 액세스를 안전하게 제어할 수 있는 웹 서비스다. IAM을 사용하여 리소스를 사용하도록 인증(로그인) 및 권한 부여(권한 있음)된 대상을 제어합니다.</p>\n</blockquote>\n</li>\n</ul>\n<hr>\n<h4>s3객체 생성</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> s3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>S3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>s3 접근에 필요한 정보를 담고 있는 객체 생성</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> param <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  Bucket<span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;&lt;버킷이름>>'</span><span class=\"token punctuation\">,</span>\n  Key<span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;&lt;버킷에 올라갈 폴더/파일이름>>'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">ACL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'public-read'</span><span class=\"token punctuation\">,</span>\n  Body<span class=\"token punctuation\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;&lt;버킷에 올릴 파일>>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  ContentType<span class=\"token punctuation\">:</span> <span class=\"token string\">'image/png'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Bucket: AWS S3에 만들어 놓은 버킷 이름</li>\n<li>Key: S3에 저장될 위치 존재하지 않으면 생성</li>\n<li>ACL: S3에 사전정의된 권한 부여 집합</li>\n<li>Body: 저장되는 데이터 [ string, buffer, stream ]</li>\n<li>ContentType: MIME 타입 [ 확장자가 없을때는 반드시 타입 설정 ]</li>\n</ul>\n<h4>s3에 파일 업로드</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">s3<span class=\"token punctuation\">.</span><span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>업로드를 실행 실행확인</li>\n</ul>","fields":{"slug":"/posts/3/","tagSlugs":["/tag/s-3/","/tag/aws/","/tag/file/"]},"frontmatter":{"date":"2019-02-25T14:10","description":"S3에 파일 업로드 하는 방법","tags":["S3","AWS","file"],"title":"S3에 파일을 업로드 하는 방법"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/3/"}}